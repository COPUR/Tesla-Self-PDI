# Tesla Delivery Companion Architecture

The Tesla Delivery Companion is a mobile application built with **React Native (TypeScript)** for the frontend and a **Node.js (TypeScript)** backend, designed to streamline Tesla vehicle delivery inspections. It integrates with Tesla's Fleet API for order status, Google Drive for media storage, and leverages the device's native mail app to send PDF reports.

## Architecture Overview

The application is structured into three primary layers:

1. **React Native Frontend**: Manages user interactions, offline storage, and backend communication.
2. **Node.js Backend**: Handles API routes, business logic, and external service integrations.
3. **External Services**: Comprises Tesla Fleet API, Google Drive API, and the native mail app.

Below is a high-level architecture diagram illustrating the components and their interactions:

```mermaid
graph LR
    subgraph "React Native App"
        UI[UI Components]
        Storage[AsyncStorage]
        APIClient[API Client]
        NativeModules[Native Modules]
    end
    subgraph "Node.js Backend"
        Routes[REST API Routes]
        Services[API Services]
    end
    subgraph "External Services"
        TeslaAPI[Tesla Fleet API]
        DriveAPI[Google Drive API]
        MailApp[Native Mail App]
    end
    UI --> Storage : save/load data
    UI --> APIClient : make API calls
    APIClient --> Routes : HTTP requests
    Routes --> Services : use services
    Services --> TeslaAPI : API calls (authenticated)
    Services --> DriveAPI : API calls
    UI --> NativeModules : open mail app
    NativeModules --> MailApp : send email with PDF
```

## Component Descriptions

### React Native App
- **UI Components**:
    - `ChecklistScreen`: Displays the Pre-Delivery Inspection (PDI) checklist, enabling users to mark items, add notes, and attach media.
    - `MediaCapture`: Captures photos and videos for failed checklist items.
    - `SignaturePad`: Records the user's handwritten signature.
- **AsyncStorage**: Stores checklist data, media URIs, and signatures locally for offline functionality.
- **API Client**: Facilitates HTTP requests to the backend using a library like Axios.
- **Native Modules**: Utilizes `react-native-mail` to trigger the native mail app with prefilled email content and PDF attachments.

### Node.js Backend
- **REST API Routes**:
    - `/order/status`: Retrieves order status from Tesla's Fleet API.
    - `/checklist/upload`: Uploads checklist data and media to Google Drive.
    - `/pdf/generate`: Creates a PDF report with checklist details and media links.
- **API Services**:
    - **Tesla API Service**: Manages authenticated requests to Tesla Fleet API using OAuth 2.0 with PKCE.
    - **Google Drive Service**: Handles media uploads with resumable uploads and generates shareable links.
    - **PDF Service**: Generates PDFs using `pdf-lib`, compressing them to â‰¤10 MB.

### External Services
- **Tesla Fleet API**: Supplies order status and user email data via authenticated API calls.
- **Google Drive API**: Stores media files (photos/videos) and provides HTTPS shareable links, using resumable uploads with exponential back-off.
- **Native Mail App**: Sends emails with PDF attachments to the Tesla sales representative, CC'ing the user's Tesla email.

## Key Features

- **Offline Support**: Users can complete inspections offline, with data stored in AsyncStorage and synced when connectivity is restored.
- **Authentication**: Implements OAuth 2.0 with PKCE for secure access to Tesla's Fleet API.
- **Media Handling**: Uploads media to Google Drive reliably using resumable uploads with exponential back-off.
- **PDF Generation**: Produces a PDF containing user data (name, contact, email), order number (e.g., RN123456), checklist results, and media links.
- **Email Integration**: Opens the native mail app with a prefilled email, attaching the generated PDF for seamless delivery reporting.

This architecture ensures a secure, efficient, and user-friendly experience for Tesla vehicle delivery inspections.